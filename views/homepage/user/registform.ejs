<%var cnt = 0%>
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- link = 미리 작성해둔 디자인을 css파일을 끌어옴으로써 적용. -->
<link rel="stylesheet" href="/css/admin_topnavi.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<style>
body {font-family: Arial, Helvetica, sans-serif;}
* {box-sizing: border-box;}

input[type=text], select, textarea, input[type=password] {
  width: 100%;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  margin-top: 6px;
  margin-bottom: 16px;
  resize: vertical;
}

input[type=button] {
  background-color: #4CAF50;
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=button]:hover {
  background-color: #45a049;
}

.container {
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px;
}
</style>
<script>
var cnt = 0;
var nickCnt = 0;
function getIdCheck(){
  $.ajax({
    type:"GET",
    url:"/homepage/user/idcheck",
    success : function(result, statue, xhr){
      var count = 0;
      var newid = document.getElementById("user_id")
      for(i = 0; i<result.length; i++){
        if(result[i].user_id == newid.value){
          cnt = 0
          alert("해당 ID는 이미 사용중입니다!");
          return;
        }else{
        }
      }
      if(count == 0){
        alert("사용가능ㅎ")
        newid.readOnly=true;
        cnt += 1;
      }
    },
    error : function(xhr, status,error){
      console.log("중복체크 에러", error)
    }
  })
}
function getNickCheck(){
  $.ajax({
    type:"GET",
    url:"/homepage/user/nickcheck",
    success : function(result, statue, xhr){
      var count = 0;
      var newNick = document.getElementById("user_nickname")
      for(i = 0; i<result.length; i++){
        if(result[i].user_nickname == newNick.value){
          nickCnt = 0
          alert("해당 닉네임은 이미 사용중입니다!");
          return;
        }else{
        }
      }
      if(count == 0){
        alert("사용가능한 닉네임입니다.")
        newNick.readOnly=true;
        nickCnt += 1;
      }
    },
    error : function(xhr, status,error){
      console.log("중복체크 에러", error)
    }
  })
}
function regist(){
  //유효성 체크
  var date = document.getElementById("user_birthdate").value;
  var lastdate = new Date(2021, parseInt(date/100),0).getDate();
  if(document.getElementById("user_id").value==""){
    alert("아이디를 입력하세요")
    document.getElementById("user_id").focus();
    return;
  }
  if(cnt == 0){
    alert("아이디 중복체크를 해주세요!")
    return;
  }
  if(document.getElementById("user_pass").value.length < 4){
    alert("비밀번호는 4자 이상 입력해야 합니다.")
    document.getElementById("user_pass").focus();
    return;
  }
  if(isNaN(document.getElementById("user_birthdate").value)){
    alert("생일은 4자리 숫자로 입력해야 합니다.")
    document.getElementById("user_birthdate").focus();
    return;
  }
  if(date.length != 4){
    alert("생일은 4자리 숫자로 입력해야 합니다.")
    document.getElementById("user_birthdate").focus();
    return;
  }
  if(date/100 > 13 || date/100 < 1){
    alert("생일의 앞 2자리는 12 이하의 자연수로 입력해야 합니다.")
    document.getElementById("user_birthdate").focus();
    return;
  }
  if(date%100 > lastdate ||  date%100 < 1){
    alert("생일의 뒤 2자리는 각 월의 마지막 날짜 이하의 숫자로 입력해야 합니다.")
    document.getElementById("user_birthdate").focus();
    return;
  }
  
  if(document.getElementById("user_nickname").value==""){
    alert("닉네임을 입력하세요")
    document.getElementById("user_nickname").focus();
    return;
  }
  if(nickCnt == 0){
    alert("닉네임 중복체크를 해주세요!")
    return;
  }
  if(document.getElementById("user_intro").value==""){
    alert("자기 소개를 입력하세요")
    document.getElementById("user_intro").focus();
    return;
  }
  if(document.getElementById("gender").value=="0"){
    alert("성별을 선택하세요")
    document.getElementById("gender").focus();
    return;
  }
  if(document.getElementById("age").value=="0"){
    alert("나이를 선택하세요")
    document.getElementById("age").focus();
    return;
  }
    //현재 페이지에 대해서 window, document는 하나밖에 없기에(유일성을 가지기에)
  //생략이 가능하다.
  form1.action="/user/regist"
  form1.method="post";
//바이너리 파일이 form에 포함될 경우 
  alert("반갑습니다, "+document.getElementById("user_nickname").value+" !")
  
  form1.submit();
}
</script>
</head>
<body>
  <%- include ('../inc/topnavi')%>
    
<h3>회원가입</h3>

<div class="container">
  <form name = "form1">
    <input type="text" id = "user_id" name="user_id" placeholder="Your Id">
    <input type="button" value= "중복체크" onclick= "getIdCheck()">
    
    <input type="password" id = "user_pass" name="user_pass" placeholder="Your Password">
    <input type="text" id = "user_name" name="user_name" placeholder="Your Name">
    <input type="text" id = "user_nickname" name="user_nickname" placeholder="Your NickName">
    <input type="button" value= "중복체크" onclick= "getNickCheck()">
    <input type="text" id = "user_birthdate" name="user_birthdate" placeholder="4 figures of Your birthday">
    <select id="gender" name="gender">
      <option value="0">Select Your Gender</option>
      <option value="male">남</option>
      <option value="female">여</option>
      <option value="others">기타</option>
    </select>
    <select id="age" name = "age">
      <option value="0">Select Your Age</option>
      <option value="10">미성년자</option>
      <option value="20">20~29</option>
      <option value="30">30~39</option>
      <option value="40">40~49</option>
      <option value="50">50+</option>
    </select>
    <textarea placeholder="Introduce Yourself.." id= "user_intro" name = "user_intro" style="height:200px"></textarea>
    
    <p></p>


    <input type="button" value="회원가입" onClick="regist()">

    <input type="button" value="취소" onClick="location.href='/homepage/main'">
  </form>
</div>

</body>
</html>