<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- link = 미리 작성해둔 디자인을 css파일을 끌어옴으로써 적용. -->
<link rel="stylesheet" href="/css/admin_topnavi.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<style>
body {font-family: Arial, Helvetica, sans-serif;}
* {box-sizing: border-box;}

input[type=text], select, textarea, input[type=file] {
  width: 100%;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  margin-top: 6px;
  margin-bottom: 16px;
  resize: vertical;
}

input[type=button] {
  background-color: #4CAF50;
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=button]:hover {
  background-color: #45a049;
}

.container {
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px;
}
</style>
<script>
function getcolorList(obj){
  $.ajax({
    type:"GET",
    url:"/admin/product/colorlist?seasoncategory_id="+obj.value,
    success:function(result,status,xhr){
      // alert(result[0].color_name)
      var colorcategory_id = document.getElementById("colorcategory_id");
      var len = colorcategory_id.length;
      for(var i = 0; i < len; i++){
        colorcategory_id.remove(1);
      }
      for(var i = 0; i < result.length; i++){
        var op = document.createElement("option");
        op.text = result[i].color_name;
        op.value = result[i].color_id
        colorcategory_id.add(op);
      }
    },
    error:function(xhr,status,error){
      console.log("색상카테고리 에러",error);
    }
  })
  
  $.ajax({
    type:"GET",
    url:"/admin/product/typelist?typecategory_id="+obj.value,
    success:function(result,status,xhr){
      // alert(result[0].color_name)
      var typecategory_id = document.getElementById("typecategory_id");
      var len = typecategory_id.length;
      for(var i = 0; i < len; i++){
        typecategory_id.remove(1);
      }
      for(var i = 0; i < result.length; i++){
        var op = document.createElement("option");
        op.text = result[i].type_name;
        op.value = result[i].type_id
        typecategory_id.add(op);
      }
    },
    error:function(xhr,status,error){
      console.log("종류카테고리 에러",error);
    }
  })

};


function edit(){
  //유효성 체크
  if(document.getElementById("seasoncategory_id").value=="0"){
    alert("계절 카테고리를 선택해야 합니다.")
    return;
  }
  if(document.getElementById("colorcategory_id").value=="0"){//서브 카테고리 유효성 체크
    alert("색상 카테고리를 선택해야 합니다.")
    return;
  }
  if(document.getElementById("colorcategory_id").value=="0"){//서브 카테고리 유효성 체크
    alert("종류 카테고리를 선택해야 합니다.")
    return;
  }
  if(document.getElementById("product_name").value==""){
    alert("상품명을 입력하세요")
    document.getElementById("product_name").focus();
    return;
  }
  if(document.getElementById("price").value==""){
    alert("가격을 입력하세요")
    document.getElementById("price").focus();
    return;
  }
  if(isNaN(document.getElementById("price").value)){
    alert("가격은 숫자로 입력해야 합니다.")
    document.getElementById("price").focus();
    return;
  }
  if(document.getElementById("brand").value==""){
    alert("브랜드명을 입력하세요")
    document.getElementById("brand").focus();
    return;
  }
  if(document.getElementById("detail").value==""){
    alert("상세 설명을 입력하세요")
    document.getElementById("detail").focus();
    return;
  }
  if(document.getElementById("product_img").value==""){
    alert("상품 이미지를 선택하세요")
    return;
  }
    //현재 페이지에 대해서 window, document는 하나밖에 없기에(유일성을 가지기에)
  //생략이 가능하다.
  editForm.action="/admin/product/edit"
  editForm.method="POST";
  editForm.encoding="multipart/form-data";
  //바이너리 파일이 form에 포함될 경우 
  editForm.submit();
}

function del(){
  editForm.action="/admin/product/del"
  editForm.method="POST";
  // editForm.encoding="multipart/form-data";
  editForm.submit();
  alert("삭제요청")
}
</script>
</head>
<body>
  <%- include ('../inc/topnavi')%>

    
<h3>상품수정</h3>

<div class="container">
  <form name = "editForm">
    <select id = "seasoncategory_id" name = "seasoncategory_id" onchange="getcolorList(this)">
        <option value="0">개화시기 선택</option>
        <%for(var i=0;i < record[0].length;i++){%>
            <%var seasoncategory = record[0][i];//배열에 들어있는 제이슨 꺼내기%>
        <option value="<%=seasoncategory.season_id%>"><%=seasoncategory.season_name%></option>
        <%}%>
    </select>
    <select id = "colorcategory_id" name = "colorcategory_id">
          <option value='0'>색상 선택</option>
    </select>
    <select id = "typecategory_id" name = "typecategory_id">
          <option value='0'>종류 선택</option>
    </select>



    <input type="text" id = "product_name" name="product_name" placeholder="상품명" value="<%=record[1][0].sub_name%>">
    <input type="text" id = "price" name="price" placeholder="가격" value="<%=record[1][0].price%>">
    <input type="text" id = "brand" name="brand" value="<%=record[1][0].market_name%>">
    <textarea placeholder="상세설명" id= "detail" name = "detail" style="height:200px"><%=record[1][0].detail%></textarea>
    <input type="file" name= "product_img" id = "product_img">
    <input type="hidden" name= "product_id" value="<%=record[1][0].product_id%>">
    <input type="hidden" name= "img_name" value="<%=record[1][0].filename%>">
    <p></p>
    <input type="button" value="수정" onClick="edit()">
    <input type="button" value="삭제" onClick="del()">
    <input type="button" value="목록" onClick="location.href='/admin/product/list'">
  </form>
</div>

</body>
</html>